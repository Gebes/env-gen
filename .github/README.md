# env-gen

Simply generate a typed `env` packaged for your Go project with a CLI one-liner.

## Generate mapping

Run the following command
```
go mod tidy && go run -mod=mod github.com/Gebes/env-gen/cmd/env generate && go fmt ./...
```
```
go: finding module for package github.com/Gebes/env-gen/cmd/env
generate env code from the .env file

Usage:
  env generate [flags]

Examples:
  env generate ./ent/schema
  ent generate github.com/a8m/x

Flags:
      --env string            environment file the config should be based on (default "./.env")
      --exit-on-parse-error   exits when a variable couldn't be parsed (default true)
      --godotenv              enables godotenv initial load (default true)
      --godotenv-logging      logs an error when godotenv fails
  -h, --help                  help for generate
      --log-parse-error       logs when a variable couldn't be parsed (default true)
      --output string         output file (default "./pkg/env/env.go")
      --package string        name of the package (default "env")

```
to convert a .env file
```dotenv
PORT=8080

DATABASE_URL=postgresql://postgres:asd@localhost:5432/xa
DATABASE_MAX_IDLE_CONNS=50
DATABASE_MAX_OPEN_CONNS=50
DATABASE_CONN_MAX_LIFETIME=2
```
into a typed package
```go
// Code generated by env-gen, DO NOT EDIT.
package env

import (
	"github.com/joho/godotenv"
	"log"
	"os"
	"strconv"
)

var (
	DatabaseConnMaxLifetime int
	DatabaseMaxIdleConns    int
	DatabaseMaxOpenConns    int
	DatabaseUrl             string
	Port                    int
)

func init() {

	_ = godotenv.Load()

	var err error

	hasError := false
	DatabaseConnMaxLifetime, err = strconv.Atoi(os.Getenv("DATABASE_CONN_MAX_LIFETIME"))
	if err != nil {
		hasError = true
		log.Println("Could not parse variable DATABASE_CONN_MAX_LIFETIME to a int from the environment:", err)
	}
	DatabaseMaxIdleConns, err = strconv.Atoi(os.Getenv("DATABASE_MAX_IDLE_CONNS"))
	if err != nil {
		hasError = true
		log.Println("Could not parse variable DATABASE_MAX_IDLE_CONNS to a int from the environment:", err)
	}
	DatabaseMaxOpenConns, err = strconv.Atoi(os.Getenv("DATABASE_MAX_OPEN_CONNS"))
	if err != nil {
		hasError = true
		log.Println("Could not parse variable DATABASE_MAX_OPEN_CONNS to a int from the environment:", err)
	}
	DatabaseUrl = os.Getenv("DATABASE_URL")
	Port, err = strconv.Atoi(os.Getenv("PORT"))
	if err != nil {
		hasError = true
		log.Println("Could not parse variable PORT to a int from the environment:", err)
	}

	if hasError {
		os.Exit(1)
	}
}
```

## Supported types
* string
* int
* bool

If the value of the env key is parsable to an int or bool, the type gets set accordingly. Arguments to prevent this from happening or a manual override are planned.